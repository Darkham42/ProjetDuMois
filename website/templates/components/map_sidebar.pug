div#pdm-map-sidebar.pdm-hidden
	div.btn-group-vertical.pdm-sidebar-buttons(role="group")
		button.toggle-map-sidebar.btn.btn-outline-secondary.btn-sm.mt-2(type="button" title="Afficher/masquer la barre latérale")
			i.fa.fa-bars
		if editors.pdm && editors.pdm.add
			button.editor-add-btn.btn.btn-outline-primary.btn-sm(type="button" title=editors.pdm.add.title)
				i.fa.fa-map-marked-alt

	div.overflow-auto.h-100
		//- Default panel showing legend
		div.pdm-sidebar-default.m-3
			div.map-legend
				h5 Légende
				each lg in legend
					div
						span(style=`color: ${lg.color}`) ●
						| #{lg.label}

		//- Display details of a single feature
		div.pdm-sidebar-feature.m-3.d-none

		//- Display feature editor
		div.pdm-sidebar-editor.m-3.d-none
			include map_editor.pug

script.
	const sidebarDom = document.getElementById("pdm-map-sidebar");
	if(window.innerWidth >= 768) { sidebarDom.classList.remove("pdm-hidden"); }

	// Close sidebar button
	sidebarDom.querySelector(".toggle-map-sidebar").addEventListener("click", () => {
		sidebarDom.classList.toggle("pdm-hidden");
		setTimeout(() => window.dispatchEvent(new CustomEvent("pdm_sidebar_use", { detail: { panel: "default" } })), 500);
		cancelAskFeatureLocation();
		showMarker();
	});

	// Add feature button
	const editors = !{JSON.stringify(editors)};
	if(editors.pdm && editors.pdm.add) {
		sidebarDom.querySelector(".editor-add-btn").addEventListener("click", onStartNewFeature);
	}

	// Change visible panel
	const panelDefaultDom = sidebarDom.querySelector(".pdm-sidebar-default");
	const panelFeatureDom = sidebarDom.querySelector(".pdm-sidebar-feature");
	const panelEditorDom = sidebarDom.querySelector(".pdm-sidebar-editor");

	window.addEventListener("pdm_sidebar_use", e => {
		if(e.detail.open) {
			sidebarDom.classList.remove("pdm-hidden");
		}
		if(e.detail.close) {
			sidebarDom.classList.add("pdm-hidden");
			e.detail.panel = "default";
		}
		switch(e.detail.panel) {
			case "feature":
				if(typeof e.detail.content === "string") {
					panelFeatureDom.innerHTML = e.detail.content;
				}
				else if(e.detail.content) {
					panelFeatureDom.innerHTML = '';
					panelFeatureDom.appendChild(e.detail.content);
				}
				panelDefaultDom.classList.add("d-none");
				panelEditorDom.classList.add("d-none");
				panelFeatureDom.classList.remove("d-none");
				break;

			case "editor":
				panelDefaultDom.classList.add("d-none");
				panelFeatureDom.classList.add("d-none");
				panelEditorDom.classList.remove("d-none");
				break;

			default:
				panelFeatureDom.classList.add("d-none");
				panelEditorDom.classList.add("d-none");
				panelDefaultDom.classList.remove("d-none");
		}
	});
